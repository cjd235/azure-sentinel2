{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2020-08-01",
      "name": "[concat(parameters('workspace'), '/(ElasticAgentEvent')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "eTag": "*",
        "displayName": "ElasticAgentEvent",
        "category": "Microsoft Sentinel Parser",
        "FunctionAlias": "ElasticAgentEvent",
        "query": "ElasticAgentLogs_CL\n| extend EventVendor = 'Elastic'\n| extend EventProduct = 'Elastic Agent'\n| extend EventSchemaVersion = 0.2\n| extend EventCount = 1\n| project-rename MonitoringMetricsBeatMemstatsMemorySys = monitoring_metrics_beat_memstats_memory_sys_d\n, MonitoringMetricsSystemLoadNorm = monitoring_metrics_system_load_norm_s\n, MonitoringMetricsSystemLoad1 = monitoring_metrics_system_load_1_d\n, MonitoringMetricsSystemLoad5 = monitoring_metrics_system_load_5_d\n, MonitoringMetricsSystemLoad15 = monitoring_metrics_system_load_15_d\n, MonitoringMetricsLibbeatConfigModule = monitoring_metrics_libbeat_config_module_s\n, MonitoringMetricsLibbeatOutputWrite = monitoring_metrics_libbeat_output_write_s\n, MonitoringMetricsLibbeatOutputRead = monitoring_metrics_libbeat_output_read_s\n, MonitoringMetricsLibbeatOutputEvents = monitoring_metrics_libbeat_output_events_s\n, MonitoringMetricsLibbeatPipelineClients = monitoring_metrics_libbeat_pipeline_clients_d\n, MonitoringMetricsLibbeatPipelineEvents = monitoring_metrics_libbeat_pipeline_events_s\n, MonitoringMetricsLibbeatPipelineQueue = monitoring_metrics_libbeat_pipeline_queue_s\n, MonitoringMetricsMetricbeatSystemFilesystem = monitoring_metrics_metricbeat_system_filesystem_s\n, MonitoringMetricsMetricbeatSystemCpu = monitoring_metrics_metricbeat_system_cpu_s\n, MonitoringMetricsMetricbeatSystemMemory = monitoring_metrics_metricbeat_system_memory_s\n, MonitoringMetricsMetricbeatSystemNetwork = monitoring_metrics_metricbeat_system_network_s\n, MonitoringMetricsBeatRuntimeGoroutines = monitoring_metrics_beat_runtime_goroutines_d\n, MonitoringMetricsBeatCpuSystem = monitoring_metrics_beat_cpu_system_s\n, MonitoringMetricsBeatCpuUser = monitoring_metrics_beat_cpu_user_s\n, MonitoringMetricsBeatCpuTotal = monitoring_metrics_beat_cpu_total_s\n, MonitoringMetricsBeatHandlesLimit = monitoring_metrics_beat_handles_limit_s\n, MonitoringMetricsBeatHandlesOpen = monitoring_metrics_beat_handles_open_d\n, MonitoringMetricsBeatMemstatsGcNext = monitoring_metrics_beat_memstats_gc_next_d\n, MonitoringMetricsBeatMemstatsMemoryAlloc = monitoring_metrics_beat_memstats_memory_alloc_d\n, MonitoringMetricsBeatMemstatsMemoryTotal = monitoring_metrics_beat_memstats_memory_total_d\n, MonitoringMetricsBeatMemstatsRss = monitoring_metrics_beat_memstats_rss_d\n, MonitoringMetricsBeatInfoUptime = monitoring_metrics_beat_info_uptime_s\n, MonitoringMetricsBeatInfoEphemeralId = monitoring_metrics_beat_info_ephemeral_id_g\n, MonitoringMetricsBeatInfoVersion = monitoring_metrics_beat_info_version_s\n, MonitoringEcsVersion = monitoring_ecs_version_s\n, LogLogger = log_logger_s\n, BeatStateManagementEnabled = beat_state_management_enabled_b\n, BeatStateOutputName = beat_state_output_name_s\n, BeatStateModuleCount = beat_state_module_count_d\n, BeatStateQueueName = beat_state_queue_name_s\n, ServiceId = service_id_g\n, ServiceName = service_name_s\n, ServiceAddress = service_address_s\n, ElasticAgentProcess = elastic_agent_process_s\n, SystemProcessCpuSystemTicks = system_process_cpu_system_ticks_d\n, SystemProcessCpuSystemTime = system_process_cpu_system_time_s\n, SystemProcessCpuTotalTime = system_process_cpu_total_time_s\n, SystemProcessCpuTotalValue = system_process_cpu_total_value_d\n, SystemProcessCpuTotalTicks = system_process_cpu_total_ticks_d\n, SystemProcessCpuUserTicks = system_process_cpu_user_ticks_d\n, SystemProcessCpuUserTime = system_process_cpu_user_time_s\n, SystemProcessFdLimitHard = system_process_fd_limit_hard_d\n, SystemProcessFdLimitSoft = system_process_fd_limit_soft_d\n, SystemProcessFdOpen = system_process_fd_open_d\n, SystemProcessMemorySize = system_process_memory_size_d\n, BeatType = beat_type_s\n, BeatStatsRuntimeGoroutines = beat_stats_runtime_goroutines_d\n, BeatStatsLibbeatOutputType = beat_stats_libbeat_output_type_s\n, BeatStatsLibbeatOutputWrite = beat_stats_libbeat_output_write_s\n, BeatStatsLibbeatOutputRead = beat_stats_libbeat_output_read_s\n, BeatStatsLibbeatOutputEvents = beat_stats_libbeat_output_events_s\n, BeatStatsUptimeMs = beat_stats_uptime_ms_d\n, BeatId = beat_id_g\n, SystemFilesystemFree = system_filesystem_free_d\n, SystemFilesystemDeviceName = system_filesystem_device_name_s\n, SystemFilesystemUsedPct = system_filesystem_used_pct_d\n, SystemFilesystemUsedBytes = system_filesystem_used_bytes_d\n, SystemFilesystemType = system_filesystem_type_s\n, SystemFilesystemFreeFiles = system_filesystem_free_files_d\n, SystemFilesystemMountPoint = system_filesystem_mount_point_s\n, SystemFilesystemFiles = system_filesystem_files_d\n, SystemFilesystemAvailable = system_filesystem_available_d\n, SystemFilesystemTotal = system_filesystem_total_d\n, InputType = input_type_s\n, LogOffset = log_offset_d\n, LogPath = log_path_s\n, LogLevel = log_level_s\n, LogOriginFileLine = log_origin_file_line_d\n, LogOriginFileName = log_origin_file_name_s\n, EcsVersion = ecs_version_s\n, Timestamp = _timestamp_t\n, MetricsetName = metricset_name_s\n, MetricsetPeriod = metricset_period_d\n, EventDataset = event_dataset_s\n, EventModule = event_module_s\n, EventDuration = event_duration_d\n, DataStreamType = data_stream_type_s\n, DataStreamNamespace = data_stream_namespace_s\n, DataStreamDataset = data_stream_dataset_s\n, Tags = tags_s\n, ElasticAgentSnapshot = elastic_agent_snapshot_b\n, ElasticAgentVersion = elastic_agent_version_s\n, ElasticAgentId = elastic_agent_id_g\n, DvcHostname = host_name_s\n, DvcIpAddr = host_ip_s\n, DvcId = host_id_g\n, HostContainerized = host_containerized_b\n, DvcOs = host_os_name_s\n, HostOsType = host_os_type_s\n, HostOsCodename = host_os_codename_s\n, HostOsPlatform = host_os_platform_s\n, HostOsFamily = host_os_family_s\n, DvcOsVersion = host_os_version_s\n, HostOsKernel = host_os_kernel_s\n, SrcMacAddr = host_mac_s\n, HostHostname = host_hostname_s\n, HostArchitecture = host_architecture_s\n, SystemNetworkName = system_network_name_s\n, SystemNetworkInErrors = system_network_in_errors_d\n, SystemNetworkInDropped = system_network_in_dropped_d\n, SystemNetworkInBytes = system_network_in_bytes_d\n, SystemNetworkInPackets = system_network_in_packets_d\n, SystemNetworkOutDropped = system_network_out_dropped_d\n, SystemNetworkOutErrors = system_network_out_errors_d\n, SystemNetworkOutBytes = system_network_out_bytes_d\n, SystemNetworkOutPackets = system_network_out_packets_d\n, ServiceType = service_type_s\n, EventProductVersion = _version_s\n, AgentName = agent_name_s\n, AgentEphemeralId = agent_ephemeral_id_g\n, AgentType = agent_type_s\n, AgentVersion = agent_version_s\n, AgentHostname = agent_hostname_s\n, AgentId = agent_id_g\n, HostCpuUsage = host_cpu_usage_d\n, SystemCpuNicePct = system_cpu_nice_pct_d\n, SystemCpuNiceNormPct = system_cpu_nice_norm_pct_d\n, SystemCpuIowaitPct = system_cpu_iowait_pct_d\n, SystemCpuIowaitNormPct = system_cpu_iowait_norm_pct_d\n, SystemCpuSoftirqPct = system_cpu_softirq_pct_d\n, SystemCpuSoftirqNormPct = system_cpu_softirq_norm_pct_d\n, SystemCpuSystemPct = system_cpu_system_pct_d\n, SystemCpuSystemNormPct = system_cpu_system_norm_pct_d\n, SystemCpuUserPct = system_cpu_user_pct_d\n, SystemCpuUserNormPct = system_cpu_user_norm_pct_d\n, SystemCpuStealNormPct = system_cpu_steal_norm_pct_d\n, SystemCpuStealPct = system_cpu_steal_pct_d\n, SystemCpuIrqPct = system_cpu_irq_pct_d\n, SystemCpuIrqNormPct = system_cpu_irq_norm_pct_d\n, SystemCpuCores = system_cpu_cores_d\n, SystemCpuIdleNormPct = system_cpu_idle_norm_pct_d\n, SystemCpuIdlePct = system_cpu_idle_pct_d\n, SystemCpuTotalPct = system_cpu_total_pct_d\n, SystemCpuTotalNormPct = system_cpu_total_norm_pct_d\n, SystemMemoryFree = system_memory_free_d\n, SystemMemoryUsedPct = system_memory_used_pct_d\n, SystemMemoryUsedBytes = system_memory_used_bytes_d\n, SystemMemorySwapFree = system_memory_swap_free_d\n, SystemMemorySwapUsedBytes = system_memory_swap_used_bytes_d\n, SystemMemorySwapTotal = system_memory_swap_total_d\n, SystemMemoryTotal = system_memory_total_d\n, SystemMemoryActualFree = system_memory_actual_free_d\n, SystemMemoryActualUsedPct = system_memory_actual_used_pct_d\n, SystemMemoryActualUsedBytes = system_memory_actual_used_bytes_d\n, SystemMemoryCached = system_memory_cached_d\n, SrcBytes = host_network_egress_bytes_d\n, SrcPackets = host_network_egress_packets_d\n, DstBytes = host_network_ingress_bytes_d\n, DstPackets = host_network_ingress_packets_d\n",
        "version": 1,
        "tags": []
      }
    }
  ]
}
