{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2020-08-01",
      "name": "[concat(parameters('workspace'), '/(SophosXGFirewall')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "eTag": "*",
        "displayName": "SophosXGFirewall",
        "category": "Microsoft Sentinel Parser",
        "FunctionAlias": "SophosXGFirewall",
        "query": "Syslog\n| where Computer in (\"52.152.175.228\") and Facility == \"local0\"\n| extend Device = extract(@'device=\\\"(\\S+)\\\"', 1, SyslogMessage),\nDate = extract(@'date=(\\S+)', 1, SyslogMessage),\nTime = extract(@'time=(\\S+)', 1, SyslogMessage),\nTimezone = extract(@'timezone=\\\"(\\S+)\\\"', 1, SyslogMessage),\nDevice_Name = extract(@'device_name=\\\"(\\S+)\\\"', 1, SyslogMessage),\nDevice_ID = extract(@'device_id=(\\S+)', 1, SyslogMessage),\nLog_ID = extract(@'(log_id|messageid)=\\\"?(\\d+)\\\"?', 2, SyslogMessage),\nLog_Type = extract(@'log_type=\\\"?([\\w\\s]+)\\\"?', 1, SyslogMessage),\nLog_Component = extract(@'log_component=\\\"([\\w\\s]+)\\\"', 1, SyslogMessage),\nLog_Subtype = extract(@'log_subtype=\\\"([\\w]+)\\\"', 1, SyslogMessage),\nStatus = extract(@'status=\\\"?(\\w+)\\\"?', 1, SyslogMessage),\nPriority = extract(@'priority=(\\S+)', 1, SyslogMessage),\nDuration = extract(@'(con_duration|duration)=(\\S+)', 2, SyslogMessage),\nFW_Rule_ID = extract(@'fw_rule_id=\\\"?(\\S+)\\\"?', 1, SyslogMessage),\nPolicy_Type = extract(@'policy_type=(\\S+)', 1, SyslogMessage),\nUser_Name = extract(@'(user_name|user)=\\\"(\\S+)\\\"',2, SyslogMessage),\nUser_GP = extract(@'(user_gp|user_group)=\\\"(\\S+)\\\"', 2, SyslogMessage),\nIAP = extract(@'iap=(\\S+)', 1, SyslogMessage),\nIPS_Policy_ID = extract(@'ips_policy_id=(\\S+)', 1, SyslogMessage),\nAppfilter_Policy_ID = extract(@'appfilter_policy_id=(\\S+)', 1, SyslogMessage),\nApplication = extract(@'(application|app_name)=\\\"(\\S+)\\\"', 2, SyslogMessage),\nApplication_Risk = extract(@'(application_risk|app_risk)=(\\S+)', 2, SyslogMessage),\nApplication_Technology = extract(@'(application_technology|app_technology)=\\\"(\\S+)\\\"', 2, SyslogMessage),\nApplication_Category = extract(@'(application_category|app_category)=\\\"(\\S+)\\\"', 2, SyslogMessage),\nIn_Interface = extract(@'in_interface=\\\"(\\S+)\\\"', 1, SyslogMessage),\nOut_Interface = extract(@'out_interface=\\\"(\\S+)\\\"', 1, SyslogMessage),\nSrc_MAC = extract(@'src_mac=\\\"?([\\w\\:]+)\\\"?', 1, SyslogMessage),\nSrc_IP = extract(@'src_ip=\\\"?([\\w\\.]+)\\\"?', 1, SyslogMessage),\nSrc_Country_Code = extract(@'(src_country|src_country_code)=\\\"?(\\w+)\\\"?', 2, SyslogMessage),\nDst_MAC = extract(@'dst_mac=\\\"?([\\w\\:]+)\\\"?', 1, SyslogMessage),\nDst_IP = extract(@'dst_ip=\\\"?([\\w\\.]+)\\\"?', 1, SyslogMessage),\nDst_Country_Code = extract(@'(dst_country|dst_country_code)=\\\"?(\\w+)\\\"?', 2, SyslogMessage),\nProtocol = extract(@'protocol=\\\"?(\\w+)\\\"?', 1, SyslogMessage),\nSrc_Port = extract(@'src_port=\\\"?(\\d+)\\\"?', 1, SyslogMessage),\nDst_Port = extract(@'dst_port=\\\"?(\\d+)\\\"?', 1, SyslogMessage),\nSent_Pkts = extract(@'(packets_sent|sent_pkts)=\\\"?(\\d+)\\\"?', 2, SyslogMessage),\nRecv_Pkts = extract(@'(packets_received|recv_pkts)=\\\"?(\\d+)\\\"?', 2, SyslogMessage),\nSent_Bytes = extract(@'(bytes_sent|sent_bytes)=\\\"?(\\d+)\\\"?', 2, SyslogMessage),\nRecv_Bytes = extract(@'(bytes_received|recv_bytes)=\\\"?(\\d+)\\\"?', 2, SyslogMessage),\nTran_Src_IP = extract(@'(src_trans_ip|tran_src_ip)=(\\S+)', 2, SyslogMessage),\nTran_Src_Port = extract(@'(src_trans_port|tran_src_port)=\\\"?(\\d+)\\\"?', 2, SyslogMessage),\nTran_Dst_IP = extract(@'(dst_trans_ip|tran_dst_ip)=(\\S+)', 2, SyslogMessage),\nTran_Dst_Port = extract(@'(dst_trans_port|tran_dst_port)=\\\"?(\\d+)\\\"?', 2, SyslogMessage),\nSrczonetype = extract(@'(src_zone_type|srczonetype)=\\\"(\\S+)\\\"', 2, SyslogMessage),\nSrczone = extract(@'(src_zone|srczone)=\\\"(\\S+)\\\"', 2, SyslogMessage),\nDstzonetype = extract(@'(dst_zone_type|dstzonetype)=\\\"(\\S+)\\\"', 2, SyslogMessage),\nDstzone = extract(@'(dst_zone|dstzone)=\\\"(\\S+)\\\"', 2, SyslogMessage),\nDir_Disp = extract(@'dir_disp=\\\"(\\S+)\\\"', 1, SyslogMessage),\nConnevent = extract(@'connevent=\\\"(\\S+)\\\"', 1, SyslogMessage),\nConnID = extract(@'(con_id|connid)=\\\"(\\S+)\\\"', 2, SyslogMessage),\nVconnID = extract(@'(virt_con_id|vconnid)=\\\"(\\S+)\\\"', 2, SyslogMessage),\nHB_Health = extract(@'(hb_status|hb_health)=\\\"(\\S+)\\\"', 2, SyslogMessage),\nMessage = extract(@'message=\\\"([\\S\\s]+)\\.\\\"', 1, SyslogMessage),\nAppResolvedBy = extract(@'appresolvedby=\\\"(\\S+)\\\"', 1, SyslogMessage),\nNat_Rule_ID = extract(@'nat_rule_id=(\\S+)', 1, SyslogMessage),\nVlan_ID = extract(@'vlan_id=\\\"(\\S+)\\\"', 1, SyslogMessage),\nEther_Type = extract(@'ether_type=\\\"(\\S+)\\\"', 1, SyslogMessage),\nBridge_Name = extract(@'bridge_name=\\\"(\\S+)\\\"', 1, SyslogMessage),\nWeb_Policy_ID = extract(@'web_policy_id=\\\"(\\S+)\\\"', 1, SyslogMessage),\nApp_IS_Cloud = extract(@'app_is_cloud=\\\"(\\S+)\\\"', 1, SyslogMessage),\nBridge_Display_Name = extract(@'bridge_display_name=\\\"(\\S+)\\\"', 1, SyslogMessage),\nIn_Display_Interface = extract(@'in_display_interface=\\\"(\\S+)\\\"', 1, SyslogMessage),\nOut_Display_Interface = extract(@'out_display_interface=\\\"(\\S+)\\\"', 1, SyslogMessage)\n",
        "version": 1,
        "tags": []
      }
    }
  ]
}
