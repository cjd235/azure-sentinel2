{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2020-08-01",
      "name": "[concat(parameters('workspace'), '/(Cloudflare')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "eTag": "*",
        "displayName": "Cloudflare",
        "category": "Microsoft Sentinel Parser",
        "FunctionAlias": "Cloudflare",
        "query": "Cloudflare_CL\n| extend\n    BotScore_d=column_ifexists('BotScore_d', ''),\n    BotScoreSrc_s=column_ifexists('BotScoreSrc_s', ''),\n    CacheCacheStatus_s=column_ifexists('CacheCacheStatus_s', ''),\n    CacheResponseBytes_d=column_ifexists('CacheResponseBytes_d', ''),\n    CacheResponseStatus_d=column_ifexists('CacheResponseStatus_d', ''),\n    CacheTieredFill_b=column_ifexists('CacheTieredFill_b', ''),\n    ClientASN_d=column_ifexists('ClientASN_d', ''),\n    ClientCountry_s=column_ifexists('ClientCountry_s', ''),\n    ClientDeviceType_s=column_ifexists('ClientDeviceType_s', ''),\n    ClientIP_s=column_ifexists('ClientIP_s', ''),\n    ClientIPClass_s=column_ifexists('ClientIPClass_s', ''),\n    ClientRequestHost_s=column_ifexists('ClientRequestHost_s', ''),\n    ClientRequestMethod_s=column_ifexists('ClientRequestMethod_s', ''),\n    ClientRequestPath_s=column_ifexists('ClientRequestPath_s', ''),\n    ClientRequestProtocol_s=column_ifexists('ClientRequestProtocol_s', ''),\n    ClientRequestReferer_s=column_ifexists('ClientRequestReferer_s', ''),\n    ClientRequestURI_s=column_ifexists('ClientRequestURI_s', ''),\n    ClientRequestUserAgent_s=column_ifexists('ClientRequestUserAgent_s', ''),\n    ClientSSLCipher_s=column_ifexists('ClientSSLCipher_s', ''),\n    ClientSSLProtocol_s=column_ifexists('ClientSSLProtocol_s', ''),\n    ClientXRequestedWith_s=column_ifexists('ClientXRequestedWith_s', ''),\n    EdgeColoCode_s=column_ifexists('EdgeColoCode_s', ''),\n    EdgeColoID_d=column_ifexists('EdgeColoID_d', ''),\n    EdgeEndTimestamp_t=column_ifexists('EdgeEndTimestamp_t', ''),\n    EdgePathingOp_s=column_ifexists('EdgePathingOp_s', ''),\n    EdgePathingSrc_s=column_ifexists('EdgePathingSrc_s', ''),\n    EdgePathingStatus_s=column_ifexists('EdgePathingStatus_s', ''),\n    EdgeRateLimitAction_s=column_ifexists('EdgeRateLimitAction_s', ''),\n    EdgeRateLimitID_d=column_ifexists('EdgeRateLimitID_d', ''),\n    EdgeRequestHost_s=column_ifexists('EdgeRequestHost_s', ''),\n    EdgeResponseBytes_d=column_ifexists('EdgeResponseBytes_d', ''),\n    EdgeResponseCompressionRatio_d=column_ifexists('EdgeResponseCompressionRatio_d', ''),\n    EdgeResponseContentType_s=column_ifexists('EdgeResponseContentType_s', ''),\n    EdgeResponseStatus_d=column_ifexists('EdgeResponseStatus_d', ''),\n    EdgeServerIP_s=column_ifexists('EdgeServerIP_s', ''),\n    EdgeStartTimestamp_t=column_ifexists('EdgeStartTimestamp_t', ''),\n    FirewallMatchesActions_s=column_ifexists('FirewallMatchesActions_s', ''),\n    FirewallMatchesRuleIDs_s=column_ifexists('FirewallMatchesRuleIDs_s', ''),\n    FirewallMatchesSources_s=column_ifexists('FirewallMatchesSources_s', ''),\n    OriginIP_s=column_ifexists('OriginIP_s', ''),\n    OriginResponseBytes_d=column_ifexists('OriginResponseBytes_d', ''),\n    OriginResponseHTTPExpires_s=column_ifexists('OriginResponseHTTPExpires_s', ''),\n    OriginResponseHTTPLastModified_s=column_ifexists('OriginResponseHTTPLastModified_s', ''),\n    OriginResponseStatus_d=column_ifexists('OriginResponseStatus_d', ''),\n    OriginResponseTime_d=column_ifexists('OriginResponseTime_d', ''),\n    OriginSSLProtocol_s=column_ifexists('OriginSSLProtocol_s', ''),\n    ParentRayID_s=column_ifexists('ParentRayID_s', ''),\n    RayID_s=column_ifexists('RayID_s', ''),\n    SecurityLevel_s=column_ifexists('SecurityLevel_s', ''),\n    WAFAction_s=column_ifexists('WAFAction_s', ''),\n    WAFFlags_s=column_ifexists('WAFFlags_s', ''),\n    WAFMatchedVar_s=column_ifexists('WAFMatchedVar_s', ''),\n    WAFProfile_s=column_ifexists('WAFProfile_s', ''),\n    WAFRuleID_s=column_ifexists('WAFRuleID_s', ''),\n    WAFRuleMessage_s=column_ifexists('WAFRuleMessage_s', ''),\n    WorkerCPUTime_d=column_ifexists('WorkerCPUTime_d', ''),\n    WorkerStatus_s=column_ifexists('WorkerStatus_s', ''),\n    WorkerSubrequest_b=column_ifexists('WorkerSubrequest_b', ''),\n    WorkerSubrequestCount_d=column_ifexists('WorkerSubrequestCount_d', ''),\n    ZoneID_d=column_ifexists('ZoneID_d', ''),\n    Application_s=column_ifexists('Application_s', ''),\n    ClientMatchedIpFirewall_s=column_ifexists('ClientMatchedIpFirewall_s', ''),\n    ClientProto_s=column_ifexists('ClientProto_s', ''),\n    ClientTcpRtt_d=column_ifexists('ClientTcpRtt_d', ''),\n    ClientTlsCipher_s=column_ifexists('ClientTlsCipher_s', ''),\n    ClientTlsClientHelloServerName_s=column_ifexists('ClientTlsClientHelloServerName_s', ''),\n    ClientTlsProtocol_s=column_ifexists('ClientTlsProtocol_s', ''),\n    ClientTlsStatus_s=column_ifexists('ClientTlsStatus_s', ''),\n    ColoCode_s=column_ifexists('ColoCode_s', ''),\n    ConnectTimestamp_t=column_ifexists('ConnectTimestamp_t', ''),\n    DisconnectTimestamp_t=column_ifexists('DisconnectTimestamp_t', ''),\n    Event_s=column_ifexists('Event_s', ''),\n    IpFirewall_b=column_ifexists('IpFirewall_b', ''),\n    OriginBytes_d=column_ifexists('OriginBytes_d', ''),\n    OriginPort_d=column_ifexists('OriginPort_d', ''),\n    OriginProto_s=column_ifexists('OriginProto_s', ''),\n    OriginTcpRtt_d=column_ifexists('OriginTcpRtt_d', ''),\n    OriginTlsCipher_s=column_ifexists('OriginTlsCipher_s', ''),\n    OriginTlsFingerprint_s=column_ifexists('OriginTlsFingerprint_s', ''),\n    OriginTlsMode_s=column_ifexists('OriginTlsMode_s', ''),\n    OriginTlsProtocol_s=column_ifexists('OriginTlsProtocol_s', ''),\n    OriginTlsStatus_s=column_ifexists('OriginTlsStatus_s', ''),\n    ProxyProtocol_s=column_ifexists('ProxyProtocol_s', ''),\n    Status_d=column_ifexists('Status_d', ''),\n    Timestamp_t=column_ifexists('Timestamp_t', ''),\n    Action_s=column_ifexists('Action_s', ''),\n    ClientASNDescription_s=column_ifexists('ClientASNDescription_s', ''),\n    ClientRefererHost_s=column_ifexists('ClientRefererHost_s', ''),\n    ClientRefererPath_s=column_ifexists('ClientRefererPath_s', ''),\n    ClientRefererQuery_s=column_ifexists('ClientRefererQuery_s', ''),\n    ClientRefererScheme_s=column_ifexists('ClientRefererScheme_s', ''),\n    ClientRequestQuery_s=column_ifexists('ClientRequestQuery_s', ''),\n    ClientRequestScheme_s=column_ifexists('ClientRequestScheme_s', ''),\n    Datetime_t=column_ifexists('Datetime_t', ''),\n    Kind_s=column_ifexists('Kind_s', ''),\n    MatchIndex_d=column_ifexists('MatchIndex_d', ''),\n    OriginatorRayID_s=column_ifexists('OriginatorRayID_s', ''),\n    RuleID_s=column_ifexists('RuleID_s', ''),\n    Source_s=column_ifexists('Source_s', '')\n| extend\n    SrcDvcType=iff(isempty(ClientDeviceType_s), iff(isempty(Source_s), '', Source_s), ClientDeviceType_s),\n    TlsCipher=iff(isempty(ClientSSLCipher_s), iff(isempty(ClientTlsCipher_s), '', ClientTlsCipher_s), ClientSSLCipher_s),\n    TlsVersion=iff(isempty(ClientSSLProtocol_s), iff(isempty(ClientTlsProtocol_s), '', ClientTlsProtocol_s), ClientSSLProtocol_s),\n    DvcAction=iff(isempty(FirewallMatchesActions_s), iff(isempty(Event_s), iff(isempty(Action_s), '', Action_s), Event_s), FirewallMatchesActions_s),\n    NetworkRuleName=iff(isempty(FirewallMatchesRuleIDs_s), iff(isempty(RuleID_s), '', RuleID_s), FirewallMatchesRuleIDs_s),\n    ClientRequestBytes_d=column_ifexists('ClientRequestBytes_d', column_ifexists('ClientBytes_d', '')),\n    ClientSrcPort_d=column_ifexists('ClientSrcPort_d', column_ifexists('ClientPort_d', '')),\n    EdgeResponseBytes_d=column_ifexists('EdgeResponseBytes_d', column_ifexists('OriginBytes_d', ''))\n| project-rename\n    SrcBytes=ClientRequestBytes_d,\n    SrcPortNumber=ClientSrcPort_d,\n    DstBytes=EdgeResponseBytes_d,\n    BotScore=BotScore_d,\n    BotScoreSrc=BotScoreSrc_s,\n    CacheCacheStatus=CacheCacheStatus_s,\n    CacheResponseBytes=CacheResponseBytes_d,\n    CacheResponseStatus=CacheResponseStatus_d,\n    CacheTieredFill=CacheTieredFill_b,\n    ClientASN=ClientASN_d,\n    SrcGeoCountry=ClientCountry_s,\n    SrcIpAddr=ClientIP_s,\n    ClientIPClass=ClientIPClass_s,\n    HttpRequestHeaderHost=ClientRequestHost_s,\n    HttpRequestMethod=ClientRequestMethod_s,\n    ClientRequestPath=ClientRequestPath_s,\n    ClientRequestProtocol=ClientRequestProtocol_s,\n    HttpReferrerOriginal=ClientRequestReferer_s,\n    ClientRequestURI=ClientRequestURI_s,\n    HttpUserAgentOriginal=ClientRequestUserAgent_s,\n    ClientXRequestedWith=ClientXRequestedWith_s,\n    EdgeColoCode=EdgeColoCode_s,\n    EdgeColoID=EdgeColoID_d,\n    EdgeEndTimestamp=EdgeEndTimestamp_t,\n    EdgePathingOp=EdgePathingOp_s,\n    EdgePathingSrc=EdgePathingSrc_s,\n    EdgePathingStatus=EdgePathingStatus_s,\n    EdgeRateLimitAction=EdgeRateLimitAction_s,\n    EdgeRateLimitID=EdgeRateLimitID_d,\n    EdgeRequestHost=EdgeRequestHost_s,\n    EdgeResponseCompressionRatio=EdgeResponseCompressionRatio_d,\n    HttpContentType=EdgeResponseContentType_s,\n    EdgeResponseStatus=EdgeResponseStatus_d,\n    EdgeServerIP=EdgeServerIP_s,\n    EdgeStartTimestamp=EdgeStartTimestamp_t,\n    FirewallMatchesSources=FirewallMatchesSources_s,\n    DstIpAddr=OriginIP_s,\n    OriginResponseBytes=OriginResponseBytes_d,\n    OriginResponseHTTPExpires=OriginResponseHTTPExpires_s,\n    OriginResponseHTTPLastModified=OriginResponseHTTPLastModified_s,\n    HttpStatusCode=OriginResponseStatus_d,\n    OriginResponseTime=OriginResponseTime_d,\n    OriginSSLProtocol=OriginSSLProtocol_s,\n    ParentRayID=ParentRayID_s,\n    RayID=RayID_s,\n    SecurityLevel=SecurityLevel_s,\n    WAFAction=WAFAction_s,\n    WAFFlags=WAFFlags_s,\n    WAFMatchedVar=WAFMatchedVar_s,\n    WAFProfile=WAFProfile_s,\n    WAFRuleID=WAFRuleID_s,\n    WAFRuleMessage=WAFRuleMessage_s,\n    WorkerCPUTime=WorkerCPUTime_d,\n    WorkerStatus=WorkerStatus_s,\n    WorkerSubrequest=WorkerSubrequest_b,\n    WorkerSubrequestCount=WorkerSubrequestCount_d,\n    ZoneID=ZoneID_d,\n    Application=Application_s,\n    ClientMatchedIpFirewall=ClientMatchedIpFirewall_s,\n    NetworkProtocol=ClientProto_s,\n    ClientTcpRtt=ClientTcpRtt_d,\n    ClientTlsClientHelloServerName=ClientTlsClientHelloServerName_s,\n    ClientTlsStatus=ClientTlsStatus_s,\n    ColoCode=ColoCode_s,\n    ConnectTimestamp=ConnectTimestamp_t,\n    DisconnectTimestamp=DisconnectTimestamp_t,\n    IpFirewall=IpFirewall_b,\n    DstPortNumber=OriginPort_d,\n    OriginProto=OriginProto_s,\n    OriginTcpRtt=OriginTcpRtt_d,\n    OriginTlsCipher=OriginTlsCipher_s,\n    OriginTlsFingerprint=OriginTlsFingerprint_s,\n    OriginTlsMode=OriginTlsMode_s,\n    OriginTlsProtocol=OriginTlsProtocol_s,\n    OriginTlsStatus=OriginTlsStatus_s,\n    ProxyProtocol=ProxyProtocol_s,\n    EventResult=Status_d,\n    Timestamp=Timestamp_t,\n    ClientASNDescription=ClientASNDescription_s,\n    ClientRefererHost=ClientRefererHost_s,\n    ClientRefererPath=ClientRefererPath_s,\n    ClientRefererQuery=ClientRefererQuery_s,\n    ClientRefererScheme=ClientRefererScheme_s,\n    ClientRequestQuery=ClientRequestQuery_s,\n    ClientRequestScheme=ClientRequestScheme_s,\n    Datetime=Datetime_t,\n    EventSubType=Kind_s,\n    MatchIndex=MatchIndex_d,\n    OriginatorRayID=OriginatorRayID_s\n| project-away \n    ClientDeviceType_s,\n    Source_s,\n    ClientSSLCipher_s,\n    ClientTlsCipher_s,\n    ClientSSLProtocol_s,\n    ClientTlsProtocol_s,\n    FirewallMatchesActions_s,\n    Event_s,\n    Action_s,\n    FirewallMatchesRuleIDs_s,\n    RuleID_s\n",
        "version": 1,
        "tags": []
      }
    }
  ]
}
