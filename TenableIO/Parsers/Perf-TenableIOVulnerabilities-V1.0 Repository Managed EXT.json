{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2020-08-01",
      "name": "[concat(parameters('workspace'), '/(TenableIOVulnerabilities')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "eTag": "*",
        "displayName": "TenableIOVulnerabilities",
        "category": "Microsoft Sentinel Parser",
        "FunctionAlias": "TenableIOVulnerabilities",
        "query": "Tenable_IO_Vuln_CL\n| extend \n    EventVendor=\"TenableIO\",\n    EventProduct=\"Vulnerabilities\",\n    EventType='VulnerabilityExport',\n    AssetAgentUUID=column_ifexists('asset_agent_uuid_g', ''),\n    AssetBIOSUUID=column_ifexists('asset_bios_uuid_g', ''),\n    AssetDeviceType=column_ifexists('asset_device_type_s', ''),\n    AssetFQDN=column_ifexists('asset_fqdn_s', ''),\n    AssetHostname=column_ifexists('asset_hostname_s', ''),\n    AssetIPV4=column_ifexists('asset_ipv4_s', ''),\n    AssetIPV6=column_ifexists('asset_ipv6_s', ''),\n    AssetLastAuthenticatedScanDate=column_ifexists('asset_last_authenticated_results_t', ''),\n    AssetLastUnauthenticatedScanDate=column_ifexists('asset_last_unauthenticated_results_t', ''),\n    AssetMACAddress=column_ifexists('asset_mac_address_s', ''),\n    AssetNetBIOSName=column_ifexists('asset_netbios_name_s', ''),\n    AssetNetworkID=column_ifexists('asset_network_id_g', ''),\n    AssetOperatingSystem=column_ifexists('asset_operating_system_s', ''),\n    AssetTracked=column_ifexists('asset_tracked_b', ''),\n    AssetUUID=column_ifexists('asset_uuid_g', ''),\n    Computer=column_ifexists('Computer', ''),\n    FirstFoundDate=column_ifexists('first_found_t', ''),\n    IndexedDate=column_ifexists('indexed_t', ''),\n    LastFixedDate=column_ifexists('last_fixed_t', ''),\n    LastFoundDate=column_ifexists('last_found_t', ''),\n    Output=column_ifexists('output_s', ''),\n    PluginBugtraqID=column_ifexists('plugin_bid_s', ''),\n    PluginCanvasPackage=column_ifexists('plugin_canvas_package_s', ''),\n    PluginChecksForDefaultAccount=column_ifexists('plugin_checks_for_default_account_b', ''),\n    PluginChecksForMalware=column_ifexists('plugin_checks_for_malware_b', ''),\n    PluginCPE=column_ifexists('plugin_cpe_s', ''),\n    PluginCVE=column_ifexists('plugin_cve_s', ''),\n    PluginCVSS3BaseScore=column_ifexists('plugin_cvss3_base_score_d', ''),\n    PluginCVSS3TemporalScore=column_ifexists('plugin_cvss3_temporal_score_d', ''),\n    PluginCVSS3TemporalVectorExploitability=column_ifexists('plugin_cvss3_temporal_vector_exploitability_s', ''),\n    PluginCVSS3TemporalVectorRaw=column_ifexists('plugin_cvss3_temporal_vector_raw_s', ''),\n    PluginCVSS3TemporalVectorRemediationLevel=column_ifexists('plugin_cvss3_temporal_vector_remediation_level_s', ''),\n    PluginCVSS3TemporalVectorReportConfidence=column_ifexists('plugin_cvss3_temporal_vector_report_confidence_s', ''),\n    PluginCVSS3VectorAccessComplexity=column_ifexists('plugin_cvss3_vector_access_complexity_s', ''),\n    PluginCVSS3VectorAccessVector=column_ifexists('plugin_cvss3_vector_access_vector_s', ''),\n    PluginCVSS3VectorAvailabilityImpact=column_ifexists('plugin_cvss3_vector_availability_impact_s', ''),\n    PluginCVSS3VectorConfidentialityImpact=column_ifexists('plugin_cvss3_vector_confidentiality_impact_s', ''),\n    PluginCVSS3VectorIntegrityImpact=column_ifexists('plugin_cvss3_vector_integrity_impact_s', ''),\n    PluginCVSS3VectorRaw=column_ifexists('plugin_cvss3_vector_raw_s', ''),\n    PluginCVSSBaseScore=column_ifexists('plugin_cvss_base_score_d', ''),\n    PluginCVSSTemporalScore=column_ifexists('plugin_cvss_temporal_score_d', ''),\n    PluginCVSSTemporalVectorRemediationLevel=column_ifexists('plugin_cvss_temporal_vector_remediation_level_s', ''),\n    PluginCVSSTemporalVectorReportConfidence=column_ifexists('plugin_cvss_temporal_vector_report_confidence_s', ''),\n    PluginCVSSVectorAccessComplexity=column_ifexists('plugin_cvss_vector_access_complexity_s', ''),\n    PluginCVSSVectorAccessVector=column_ifexists('plugin_cvss_vector_access_vector_s', ''),\n    PluginCVSSVectorAuthentication=column_ifexists('plugin_cvss_vector_authentication_s', ''),\n    PluginCVSSVectorAvailabilityImpact=column_ifexists('plugin_cvss_vector_availability_impact_s', ''),\n    PluginCVSSVectorConfidentialityImpact=column_ifexists('plugin_cvss_vector_confidentiality_impact_s', ''),\n    PluginCVSSVectorIntegrityImpact=column_ifexists('plugin_cvss_vector_integrity_impact_s', ''),\n    PluginCVSSVectorRaw=column_ifexists('plugin_cvss_vector_raw_s', ''),\n    PluginDescription=column_ifexists('plugin_description_s', ''),\n    PluginExploitabilityEase=column_ifexists('plugin_exploitability_ease_s', ''),\n    PluginExploitedByMalware=column_ifexists('plugin_exploited_by_malware_b', ''),\n    PluginExploitedByNessus=column_ifexists('plugin_exploited_by_nessus_b', ''),\n    PluginExploitAvailable=column_ifexists('plugin_exploit_available_b', ''),\n    PluginExploitFrameworkCanvas=column_ifexists('plugin_exploit_framework_canvas_b', ''),\n    PluginExploitFrameworkMetasploit=column_ifexists('plugin_exploit_framework_metasploit_b', ''),\n    PluginFamilyID=column_ifexists('plugin_family_id_d', ''),\n    PluginFamily=column_ifexists('plugin_family_s', ''),\n    PluginHasPatch=column_ifexists('plugin_has_patch_b', ''),\n    PluginID=column_ifexists('plugin_id_d', ''),\n    PluginInTheNews=column_ifexists('plugin_in_the_news_b', ''),\n    PluginMetasploitName=column_ifexists('plugin_metasploit_name_s', ''),\n    PluginMicrosoftBulletin=column_ifexists('plugin_ms_bulletin_s', ''),\n    PluginName=column_ifexists('plugin_name_s', ''),\n    PluginPatchPublicationDate=column_ifexists('plugin_patch_publication_date_t', ''),\n    PluginPublicationDate=column_ifexists('plugin_publication_date_t', ''),\n    PluginRiskFactor=column_ifexists('plugin_risk_factor_s', ''),\n    PluginSeeAlso=column_ifexists('plugin_see_also_s', ''),\n    PluginSolution=column_ifexists('plugin_solution_s', ''),\n    PluginSTIGSeverity=column_ifexists('plugin_stig_severity_s', ''),\n    PluginSynopsis=column_ifexists('plugin_synopsis_s', ''),\n    PluginType=column_ifexists('plugin_type_s', ''),\n    PluginUnsupportedByVendor=column_ifexists('plugin_unsupported_by_vendor_b', ''),\n    PluginUbuntuSecurityNotice=column_ifexists('plugin_usn_s', ''),\n    PluginVersion=column_ifexists('plugin_version_s', ''),\n    PluginVPRDriversAgeOfVulnLowerBound=column_ifexists('plugin_vpr_drivers_age_of_vuln_lower_bound_d', ''),\n    PluginVPRDriversAgeOfVulnUpperBound=column_ifexists('plugin_vpr_drivers_age_of_vuln_upper_bound_d', ''),\n    PluginVPRDriversCVSS3ImpactScore=column_ifexists('plugin_vpr_drivers_cvss3_impact_score_d', ''),\n    PluginVPRDriversCVSSImpactScorePredicted=column_ifexists('plugin_vpr_drivers_cvss_impact_score_predicted_b', ''),\n    PluginVPRDriversExploitCodeMaturity=column_ifexists('plugin_vpr_drivers_exploit_code_maturity_s', ''),\n    PluginVPRDriversProductCoverage=column_ifexists('plugin_vpr_drivers_product_coverage_s', ''),\n    PluginVPRDriversThreatIntensityLast28=column_ifexists('plugin_vpr_drivers_threat_intensity_last28_s', ''),\n    PluginVPRDriversThreatRecencyLowerBound=column_ifexists('plugin_vpr_drivers_threat_recency_lower_bound_d', ''),\n    PluginVPRDriversThreatRecencyUpperBound=column_ifexists('plugin_vpr_drivers_threat_recency_upper_bound_d', ''),\n    PluginVPRDriversThreatSourcesLast28=column_ifexists('plugin_vpr_drivers_threat_sources_last28_s', ''),\n    PluginVPRScore=column_ifexists('plugin_vpr_score_d', ''),\n    PluginVPRUpdatedDate=column_ifexists('plugin_vpr_updated_t', ''),\n    PluginVPRPublicationDate=column_ifexists('plugin_vuln_publication_date_t', ''),\n    PluginXRefs=column_ifexists('plugin_xrefs_s', ''),\n    PortNumber=column_ifexists('port_port_d', ''),\n    PortProtocol=column_ifexists('port_protocol_s', ''),\n    PortService=column_ifexists('port_service_s', ''),\n    ScanCompletedAtTime=column_ifexists('scan_completed_at_t', ''),\n    ScanScheduleUUID=column_ifexists('scan_schedule_uuid_s', ''),\n    ScanID=column_ifexists('scan_uuid_g', ''),\n    SeverityDefaultID=column_ifexists('severity_default_id_d', ''),\n    SeverityID=column_ifexists('severity_id_d', ''),\n    SeverityModificationType=column_ifexists('severity_modification_type_s', ''),\n    Severity=column_ifexists('severity_s', ''),\n    State=column_ifexists('state_s', '')\n| project\n    AssetFQDN,\n    AssetIPV4,\n    AssetOperatingSystem,\n    Severity,\n    State,\n    PluginID,\n    PluginName,\n    PluginCVE,\n    PluginCPE,\n    PluginVPRScore,\n    PluginCVSS3BaseScore,\n    PluginCVSSBaseScore,\n    PluginFamily,\n    PluginDescription,\n    PluginSolution,\n    FirstFoundDate,\n    IndexedDate,\n    LastFixedDate,\n    LastFoundDate,\n    AssetLastAuthenticatedScanDate,\n    AssetLastUnauthenticatedScanDate,\n    AssetAgentUUID,\n    AssetBIOSUUID,\n    AssetDeviceType,\n    AssetHostname,\n    AssetIPV6,\n    AssetMACAddress,\n    AssetNetBIOSName,\n    AssetNetworkID,\n    AssetTracked,\n    AssetUUID,\n    Computer,\n    Output,\n    PluginBugtraqID,\n    PluginCanvasPackage,\n    PluginChecksForDefaultAccount,\n    PluginChecksForMalware,\n    PluginCVSS3TemporalScore,\n    PluginCVSS3TemporalVectorExploitability,\n    PluginCVSS3TemporalVectorRaw,\n    PluginCVSS3TemporalVectorRemediationLevel,\n    PluginCVSS3TemporalVectorReportConfidence,\n    PluginCVSS3VectorAccessComplexity,\n    PluginCVSS3VectorAccessVector,\n    PluginCVSS3VectorAvailabilityImpact,\n    PluginCVSS3VectorConfidentialityImpact,\n    PluginCVSS3VectorIntegrityImpact,\n    PluginCVSS3VectorRaw,\n    PluginCVSSTemporalScore,\n    PluginCVSSTemporalVectorRemediationLevel,\n    PluginCVSSTemporalVectorReportConfidence,\n    PluginCVSSVectorAccessComplexity,\n    PluginCVSSVectorAccessVector,\n    PluginCVSSVectorAuthentication,\n    PluginCVSSVectorAvailabilityImpact,\n    PluginCVSSVectorConfidentialityImpact,\n    PluginCVSSVectorIntegrityImpact,\n    PluginCVSSVectorRaw,\n    PluginExploitabilityEase,\n    PluginExploitedByMalware,\n    PluginExploitedByNessus,\n    PluginExploitAvailable,\n    PluginExploitFrameworkCanvas,\n    PluginExploitFrameworkMetasploit,\n    PluginFamilyID,\n    PluginHasPatch,\n    PluginInTheNews,\n    PluginMetasploitName,\n    PluginMicrosoftBulletin,\n    PluginPatchPublicationDate,\n    PluginPublicationDate,\n    PluginRiskFactor,\n    PluginSeeAlso,\n    PluginSTIGSeverity,\n    PluginSynopsis,\n    PluginType,\n    PluginUnsupportedByVendor,\n    PluginUbuntuSecurityNotice,\n    PluginVersion,\n    PluginVPRDriversAgeOfVulnLowerBound,\n    PluginVPRDriversAgeOfVulnUpperBound,\n    PluginVPRDriversCVSS3ImpactScore,\n    PluginVPRDriversCVSSImpactScorePredicted,\n    PluginVPRDriversExploitCodeMaturity,\n    PluginVPRDriversProductCoverage,\n    PluginVPRDriversThreatIntensityLast28,\n    PluginVPRDriversThreatRecencyLowerBound,\n    PluginVPRDriversThreatRecencyUpperBound,\n    PluginVPRDriversThreatSourcesLast28,\n    PluginVPRUpdatedDate,\n    PluginVPRPublicationDate,\n    PluginXRefs,\n    PortNumber,\n    PortProtocol,\n    PortService,\n    ScanCompletedAtTime,\n    ScanScheduleUUID,\n    ScanID,\n    SeverityDefaultID,\n    SeverityID,\n    SeverityModificationType,\n    EventVendor,\n    EventProduct,\n    EventType\n",
        "version": 1,
        "tags": []
      }
    }
  ]
}
