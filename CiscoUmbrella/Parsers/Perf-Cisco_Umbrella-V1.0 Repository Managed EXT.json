{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "workspace": {
      "type": "String"
    }
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/savedSearches",
      "apiVersion": "2020-08-01",
      "name": "[concat(parameters('workspace'), '/(Cisco_Umbrella')]",
      "location": "[resourceGroup().location]",
      "properties": {
        "eTag": "*",
        "displayName": "Cisco_Umbrella",
        "category": "Microsoft Sentinel Parser",
        "FunctionAlias": "Cisco_Umbrella",
        "query": "let Cisco_Umbrella_dns_view = view () { \n    Cisco_Umbrella_dns_CL\n    | extend \n        EventEndTime=column_ifexists('Timestamp_t', ''),\n        SrcIpAddr=column_ifexists('InternalIp_s', ''),\n        SrcNatIpAddr=column_ifexists('ExternalIp_s', ''),\n        DvcAction=column_ifexists('Action_s', ''),\n        DnsQueryName=column_ifexists('Domain_s', ''),\n        UrlCategory=column_ifexists('Categories_s', ''),\n        ThreatCategory=column_ifexists('Blocked_Categories_s', ''),\n        Identities=column_ifexists('Identities_s', ''),\n        DnsQueryTypeName=column_ifexists('QueryType_s', ''),\n        DnsResponseCodeName=column_ifexists('ResponseCode_s', ''),\n        IdentityTypes=column_ifexists('Identity_Types_s', ''),\n        EventType=column_ifexists('EventType_s', ''),\n        PolicyIdentity=column_ifexists('Policy_Identity_s', ''),\n        PolicyIdentityType=column_ifexists('Policy_Identity_Type_s', '')\n    | project \n        TimeGenerated,\n        EventEndTime,\n        SrcIpAddr,\n        SrcNatIpAddr,\n        DvcAction,\n        DnsQueryName,\n        UrlCategory,\n        ThreatCategory,\n        Identities,\n        DnsQueryTypeName,\n        DnsResponseCodeName,\n        IdentityTypes,\n        EventType,\n        PolicyIdentity,\n        PolicyIdentityType\n};\nlet Cisco_Umbrella_proxy_view = view () { \n    Cisco_Umbrella_proxy_CL\n    | extend \n        EventType=column_ifexists('EventType_s', ''),\n        EventEndTime=column_ifexists('Timestamp_t', ''),\n        Identities=column_ifexists('Identities_s', ''),\n        SrcIpAddr=column_ifexists('Internal_IP_s', ''),\n        SrcNatIpAddr=column_ifexists('External_IP_s', ''),\n        DstIpAddr=column_ifexists('Destination_IP_s', ''),\n        HttpContentType=column_ifexists('Content_Type_s', ''),\n        DvcAction=column_ifexists('Verdict_s', ''),\n        UrlOriginal=column_ifexists('URL_s', ''),\n        HttpReferrerOriginal=column_ifexists('Referer_s', ''),\n        HttpUserAgentOriginal=column_ifexists('userAgent_s', ''),\n        HttpStatusCode=column_ifexists('statusCode_s', ''),\n        SrcBytes=column_ifexists('requestSize_d', ''),\n        DstBytes=column_ifexists('responseSize_d', ''),\n        HttpResponseBodyBytes=column_ifexists('responseBodySize_d', ''),\n        HashSha256=column_ifexists('SHA-SHA256_s', ''),\n        UrlCategory=column_ifexists('Categories_s', ''),\n        AvDetections=column_ifexists('AVDetections_s', ''),\n        Puas=column_ifexists('PUAs_s', ''),\n        AmpDisposition=column_ifexists('AMP_Disposition_s', ''), \n        ThreatName=column_ifexists('AMP_Malware_Name_s', ''),\n        AmpScore=column_ifexists('AMP_Score_s', ''),\n        IdentityType=column_ifexists('Identity_Type_s', ''),\n        ThreatCategory=column_ifexists('Blocked_Categories_s', '')\n    | project\n        TimeGenerated,\n        EventType,\n        EventEndTime,\n        Identities,\n        SrcIpAddr,\n        SrcNatIpAddr,\n        DstIpAddr,\n        HttpContentType,\n        DvcAction,\n        UrlOriginal,\n        HttpReferrerOriginal,\n        HttpUserAgentOriginal,\n        HttpStatusCode,\n        SrcBytes,\n        DstBytes,\n        HttpResponseBodyBytes,\n        HashSha256,\n        UrlCategory,\n        AvDetections,\n        Puas,\n        AmpDisposition,\n        ThreatName,\n        AmpScore,\n        IdentityType,\n        ThreatCategory\n};\nlet Cisco_Umbrella_ip_view = view () { \n    Cisco_Umbrella_ip_CL\n    | extend \n        EventType=column_ifexists('EventType_s', ''),\n        EventEndTime=column_ifexists('Timestamp_t', ''),\n        Identities=column_ifexists('Identity_s', ''),\n        SrcIpAddr=column_ifexists('Source_IP_s', ''),\n        SrcPortNumber=column_ifexists('Source_Port_s', ''),\n        DstIpAddr=column_ifexists('Destination_IP_s', ''),\n        DstPortNumber=column_ifexists('Destination_Port_s', ''),\n        UrlCategory=column_ifexists('Categories_s', '')\n    | project\n        TimeGenerated,\n        EventType,\n        EventEndTime,\n        Identities,\n        SrcIpAddr,\n        SrcPortNumber,\n        DstIpAddr,\n        DstPortNumber,\n        UrlCategory\n};\nlet Cisco_Umbrella_cloudfirewall_view = view () { \n    Cisco_Umbrella_cloudfirewall_CL\n    | extend \n        EventType=column_ifexists('EventType_s', ''),\n        EventEndTime=column_ifexists('Timestamp_t', ''),\n        NetworkSessionId=column_ifexists('originId_s', ''),\n        NetworkRuleName=column_ifexists('Identity_s', ''),\n        IdentityType=column_ifexists('Identity_Type_s', ''),\n        NetworkDirection=column_ifexists('Direction_s', ''),\n        NetworkProtocol=column_ifexists('ipProtocol_s', ''),\n        NetworkPackets=column_ifexists('packetSize_s', ''),\n        SrcIpAddr=column_ifexists('SourceIP', ''),\n        SrcPortNumber=column_ifexists('sourcePort_s', ''),\n        DstIpAddr=column_ifexists('destinationIp_s', ''),\n        DstPortNumber=column_ifexists('destinationPort_s', ''),\n        DvcHostname=column_ifexists('dataCenter_s', ''),\n        NetworkRuleNumber=column_ifexists('ruleId_s', ''),\n        DvcAction=column_ifexists('verdict_s', '')\n    | project\n        TimeGenerated,\n        EventType,\n        EventEndTime,\n        NetworkSessionId,\n        NetworkRuleName,\n        IdentityType,\n        NetworkDirection,\n        NetworkProtocol,\n        NetworkPackets,\n        SrcIpAddr,\n        SrcPortNumber,\n        DstIpAddr,\n        DstPortNumber,\n        DvcHostname,\n        NetworkRuleNumber,\n        DvcAction\n};\nunion isfuzzy=true Cisco_Umbrella_dns_view, Cisco_Umbrella_proxy_view, Cisco_Umbrella_ip_view, Cisco_Umbrella_cloudfirewall_view\n",
        "version": 1,
        "tags": []
      }
    }
  ]
}
